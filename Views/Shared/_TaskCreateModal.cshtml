<div id="modalCreateTask" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm p-4">
    <div class="bg-gray-800 rounded-xl text-left overflow-hidden shadow-2xl transform transition-all w-full max-w-2xl max-h-[85vh] flex flex-col">

        <!-- Header -->
        <div class="bg-gray-800 px-5 py-3 border-b border-gray-700 flex items-center justify-between flex-shrink-0">
            <h3 id="modalTitle" class="text-lg font-semibold text-white">Tạo nhiệm vụ mới</h3>
            <button id="btnCloseModal" class="text-gray-400 hover:text-white transition-colors">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <!-- Body (cuộn được) -->
        <div class="flex-1 overflow-y-auto px-5 py-4 custom-scroll">
            <form id="formCreateTask" class="space-y-3">
                <!-- Thêm hidden field để lưu task ID khi edit -->
                <input type="hidden" id="taskId" value="">
                <!-- Tên nhiệm vụ -->
                <div>
                    <label class="block text-xs font-medium text-gray-200 mb-1.5">
                        Tên nhiệm vụ <span class="text-red-500">*</span>
                    </label>
                    <input type="text"
                           id="taskName"
                           required
                           placeholder="Nhập tên nhiệm vụ..."
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>

                <!-- Thuộc dự án -->
                <label class="block text-xs font-medium text-gray-200 mb-1.5">
                    Thuộc dự án <span class="text-red-500">*</span>
                </label>
                @await Component.InvokeAsync("ProjectSelect", new { id = "taskProjectModal", selectedId = ViewBag.SelectedProjectId })

                <!-- Mô tả -->
                <div>
                    <label class="block text-xs font-medium text-gray-200 mb-1.5">Mô tả</label>
                    <textarea id="taskDescription"
                              rows="2"
                              placeholder="Mô tả chi tiết nhiệm vụ..."
                              class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"></textarea>
                </div>

                <!-- Người thực hiện và Ưu tiên -->

                <div class="grid grid-cols-2 gap-4 items-end">
                    <!-- Cột 1: Người thực hiện -->
                    <div class="flex flex-col">
                        <label class="block text-xs font-medium text-gray-200 mb-1.5">
                            Người thực hiện
                        </label>
                        <select id="taskAssignee"
                                name="Assignee_Id"
                                required
                                disabled
                                class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-gray-200
                       focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent cursor-pointer disabled:opacity-50">
                            <option value="">-- Chọn người --</option>
                        </select>
                    </div>

                    <!-- Cột 2: Ưu tiên -->
                    <div class="flex flex-col">
                        <label class="block text-xs font-medium text-gray-200 mb-1.5">
                            Ưu tiên
                        </label>
                        <select id="taskPriority"
                                class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-gray-200
                               focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent cursor-pointer">
                            <option value="low">Thấp</option>
                            <option value="medium">Trung bình</option>
                            <option value="high">Cao</option>
                        </select>
                    </div>
                </div>


                <!-- Ngày bắt đầu và Hạn chót -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-200 mb-1.5">Ngày bắt đầu</label>
                        <input type="date"
                               id="taskStartDate"
                               min="@DateTime.Now.ToString("yyyy-MM-dd")"
                               class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent cursor-pointer">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-200 mb-1.5">Hạn chót</label>
                        <input type="date"
                               id="taskDeadline"
                               min="@DateTime.Now.ToString("yyyy-MM-dd")"
                               class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent cursor-pointer">
                    </div>
                    <!-- Schedule check result -->
                    
                </div>
                <div id="scheduleMessage"
                     class="hidden mt-3 p-3 rounded-lg text-sm border"></div>
                <!-- Upload File/Image -->
                <div>
                    <label class="block text-xs font-medium text-gray-200 mb-1.5">Đính kèm tệp</label>
                    <div class="file-upload-area border-2 border-dashed border-gray-600 rounded-lg p-4 text-center cursor-pointer hover:border-gray-500 transition-colors"
                         id="fileUploadArea">
                        <input type="file"
                               id="taskFiles"
                               multiple
                               accept="image/*,.pdf,.doc,.docx,.xls,.xlsx"
                               class="hidden">
                        <div id="uploadPlaceholder">
                            <i data-lucide="upload-cloud" class="w-8 h-8 text-gray-400 mx-auto mb-2"></i>
                            <p class="text-gray-400 text-xs mb-0.5">Nhấp để chọn hoặc kéo thả tệp vào đây</p>
                            <p class="text-gray-500 text-xs">Hỗ trợ: Ảnh, PDF, Word, Excel</p>
                        </div>
                        <div id="filePreview" class="hidden mt-3">
                            <div id="fileList" class="space-y-1.5"></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Footer -->
        <div class="bg-gray-800 px-5 py-3 border-t border-gray-700 flex justify-end gap-2 flex-shrink-0">
            <button id="btnCancelTask"
                    class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-lg text-sm font-medium transition-all">
                Hủy
            </button>
            <button id="btnSaveTask"
                    class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-all shadow-lg hover:shadow-indigo-500/50">
                Tạo nhiệm vụ
            </button>
        </div>
    </div>
</div>